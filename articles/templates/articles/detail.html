{% extends 'base.html' %}

{% block content %}
<input type="text" v-model="content" @keydown.enter="comment_create">
<button @click="comment_create">뷰버튼</button>

<h1>{{ article.pk }}번 글의 Detail </h1>
<b> 제목 : {{ article.title }} </b>
<p> 내용 : {{ article.content }} </p>
<p> 작성일시 : {{ article.created_at }} </p>
<p> 수정일시 : {{ article.updated_at }} </p>
<hr>
{% for comment in comments %}
<b>{{ comment.content }}</b>
<p>{{ comment.created_at }}</p>
<form action="{% url 'articles:comment_delete' article.pk comment.pk %}" method="POST">
  {% csrf_token %}
  <input type="submit" value="삭제">
</form>
<hr>
{% endfor %}

{% comment %} <br>
<div v-for="com_json in comments" :key="com_json.pk">
  <b>[[ com_json.content ]]</b>
  <p>[[ com_json.created_at ]]</p>
  <form action="{% url 'articles:comment_delete' article.pk  %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="삭제">
  </form>
  <hr>
</div>
<br> {% endcomment %}


<form action="{% url 'articles:comment' article.pk %}" method="POST">
  {% csrf_token %}
  {% comment %} <input type="text" name="content" id="content" required> {% endcomment %}
  <input type="submit" value="제출">
</form>

{% endblock content %}

{% block java %}
<script>
  const app = new Vue({
    delimiters: ["[[", "]]"],
    el: '#app',
    data: {
      content: '',
      comments: {{comments_json|safe}}
    },
    methods: {
      comment_create: function (e) {
        console.log('눌림')
        // const articleId = {{ article.pk }}
        axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest'
        axios.defaults.xsrfCookieName = 'csrftoken'
        axios.defaults.xsrfHeaderName = 'X-CSRFToken'
        axios.post('comment/', {content: this.content })
      }
    }
  })
</script>
{% endblock java %}
